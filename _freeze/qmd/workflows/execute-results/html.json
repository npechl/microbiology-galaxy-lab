{
  "hash": "f0839387c6224435f970d9f2157e56dd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Galaxy Tool Suites\"\nexecute:\n    eval: true\n    warning: false\nformat:\n  html:\n    fig-width: 16\n    fig-height: 8\n---\n\n\n\n\n\n## Load `libraries`\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"data.table\")\nlibrary(data.table)\n# install.packages(\"stringr\")\nlibrary(stringr)\n\n# install.packages(c(\"ggplot2\", \"ggrepel\", \"ggtext\", \"ggh4x\"))\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(ggtext)\nlibrary(ggh4x)\n\nlibrary(shadowtext)\n\n# install.packages(\"extrafont\")\nlibrary(extrafont)\n\nlibrary(packcircles)\n```\n:::\n\n\n\n\n\n## Load input dataset\n\n\n\n\n\n\n\n\n\n\n\n## Extract Tool Suite IDs\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworkflows_dt <- workflows_dt |> tidyr::separate_rows(\"Tools\", sep = \",\") |> setDT()\nall_tools_dt <- all_tools_dt |> tidyr::separate_rows(\"Tool IDs\", sep = \",\") |> setDT()\n\nworkflows_dt$Tools <- workflows_dt$Tools |> str_squish()\nall_tools_dt$`Tool IDs` <- all_tools_dt$`Tool IDs` |> str_squish()\n\nindex <- match(workflows_dt$Tools, all_tools_dt$`Tool IDs`)\n\nworkflows_dt$`Suite ID` <- all_tools_dt[index]$`Suite ID`\n```\n:::\n\n\n\n\n\n## Workflows coverage plot (EDAM): Heatmap\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt1 <- workflows_dt |> tidyr::separate_rows(\"EDAM topics\", sep = \",\") |> setDT()\ndt1 <- dt1 |> tidyr::separate_rows(\"EDAM operations\", sep = \",\") |> setDT()\n\ndt1$`EDAM topics`    <- dt1$`EDAM topics` |> str_squish()\ndt1$`EDAM operation` <- dt1$`EDAM operation` |> str_squish()\n\ndt1 <- dt1[which(!is.na(`Suite ID`)), c(\"Name\", \"Suite ID\", \"EDAM topics\", \"EDAM operation\"), with = FALSE] |> unique()\n\ndt1$`EDAM topics`    <- ifelse(dt1$`EDAM topics` == \"\", \"Other\", dt1$`EDAM topics`) |> str_wrap(15)\ndt1$`EDAM operation` <- ifelse(dt1$`EDAM operation` == \"\", \"Other\", dt1$`EDAM operation`) |> str_wrap(15)\n\nedam_operations <- dt1[, by = `EDAM operation`, .(N = Name |> unique() |> length())]\nedam_topics     <- dt1[, by = `EDAM topics`, .(N = Name |> unique() |> length())]\n\nedam_operations <- edam_operations[which(`EDAM operation` != \"Other\")] \nedam_topics     <- edam_topics[which(edam_topics != \"Other\")]\n\nedam_operations <- edam_operations[order(-N)] |> head(4)\nedam_topics     <- edam_topics[order(-N)] |> head(4)\n\ndt1$`EDAM topics`    <- ifelse(dt1$`EDAM topics` %in% edam_topics$`EDAM topics`, dt1$`EDAM topics`, \"Other\")\ndt1$`EDAM operation` <- ifelse(dt1$`EDAM operation` %in% edam_operations$`EDAM operation`, dt1$`EDAM operation`, \"Other\")\n\ndt1$`EDAM topics`    <- dt1$`EDAM topics` |> factor(c(edam_topics$`EDAM topics`, \"Other\")) \ndt1$`EDAM operation` <- dt1$`EDAM operation` |> factor(c(edam_operations$`EDAM operation`, \"Other\")) \n\n\ndt1$value <- 1\n\nmm <- dt1[, c(\"Name\", \"Suite ID\", \"value\"), with = FALSE] |> \n    unique() |> \n    dcast(Name ~ `Suite ID`, value.var = \"value\", fill = 0) |> \n    as.matrix(rownames = \"Name\")\n\nhc_y <- mm |> dist(method = \"binary\") |> hclust(method = \"ward.D2\")\nhc_x <- mm |> t() |> dist(method = \"binary\") |> hclust(method = \"ward.D2\")\n\n\ndt1$Name <- dt1$Name |> factor(levels = hc_y$labels[hc_y$order])\ndt1$`Suite ID` <- dt1$`Suite ID` |> factor(levels = hc_x$labels[hc_x$order])\n\ngr1 <- dt1 |>\n    ggplot(aes(`Suite ID`, Name)) +\n    geom_tile(color = \"white\") +\n    \n    scale_x_discrete(expand = c(0, 0)) +\n    scale_y_discrete(expand = c(0, 0)) +\n    \n    # facet_grid(rows = vars(edam_clean), scales = \"free\", space = \"free\") +\n    \n    # facet_nested_wrap(vars(`EDAM topic`, `EDAM operation`)) +\n    \n    facet_grid2(\n        rows = vars(`EDAM topics`),\n        cols = vars(`EDAM operation`),\n        space = \"free\",\n        scales = \"free\"\n    ) +\n    \n    coord_cartesian(clip = \"off\", expand = TRUE) +\n    \n    theme_minimal(base_family = \"Calibri\") +\n    theme(\n        axis.text.x = element_text(size = 2.5, angle = 45, hjust = 1),\n        axis.text.y = element_text(size = 6),\n        \n        axis.title.x = element_text(margin = margin(t = 10)),\n        axis.title.y = element_text(margin = margin(r = 10)),\n        \n        panel.border = element_rect(fill = NA, color = \"grey\", linewidth = .15),\n        # axis.ticks = element_line(linewidth = .3, color = \"grey\"),\n        \n        strip.text.x = element_text(face = \"bold\"),\n        strip.text.y = element_text(face = \"bold\", angle = 0, hjust = 0),\n        \n        panel.grid.minor = element_blank(),\n        panel.grid.major = element_line(linetype = \"dashed\", lineend = \"round\", linewidth = .35),\n        \n        plot.margin = margin(10, 10, 10, 10)\n    ) +\n    \n    labs(y = \"Workflows\", x = \"Galaxy Tool Suites\")\n```\n:::\n\n\n\n\n\n## Workflows coverage plot (Source, Project): Heatmap\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt1 <- workflows_dt[which(!is.na(`Suite ID`)), c(\"Name\", \"Suite ID\", \"Source\", \"Projects\", \"EDAM operations\"), with = FALSE] |> unique()\n\ndt1$Source   <- ifelse(\n    dt1$Source == \"WorkflowHub\", \"WorkflowHub\", \n    ifelse(\n        dt1$Source == \"dev.WorkflowHub\", \"GTN\", \n        \"Public Servers\"\n    )\n)\n\ndt1$Projects <- ifelse(\n    dt1$Projects == \"Intergalactic Workflow Commission (IWC)\", \"IWC\",\n    ifelse(\n        dt1$Projects == \"Galaxy Training Network\", \"GTN\", \n        \"Other Projects\"\n    )\n) |> str_wrap(22)\n\ndt1$cluster <- paste0(dt1$Source, \"; \", dt1$Projects)\n\ndt1$cluster <- ifelse(\n    dt1$cluster == \"WorkflowHub; IWC\", \"IWC on WorkflowHub\",\n    ifelse(\n        dt1$cluster == \"WorkflowHub; Other Projects\", \"Other WorkflowHub workflows\", \n        ifelse(\n            dt1$cluster == \"Public Servers; Other Projects\", \"Public server workflows\", \n            \"Workflows related to GTN tutorials\"\n        )\n    )\n) |> str_wrap(15)\n\ndt1 <- dt1 |> tidyr::separate_rows(\"EDAM operations\", sep = \"\\\\,\") |> setDT()\n\ndt1$`EDAM operations` <- dt1$`EDAM operations` |> str_squish()\ndt1$`EDAM operations` <- dt1$`EDAM operations` |> str_wrap(15) |> str_replace(\"DNA barcoding\", \"DNA\\nbarcoding\")\n\nedam_operations <- dt1[, by = `EDAM operations`, .(N = Name |> unique() |> length())]\nedam_operations <- edam_operations[order(-N)] |> head(4)\n\ndt1$`EDAM operations` <- ifelse(dt1$`EDAM operations` %in% edam_operations$`EDAM operations`, dt1$`EDAM operations`, \"Other\")\ndt1$`EDAM operations` <- dt1$`EDAM operations` |> factor(c(edam_operations$`EDAM operations`, \"Other\")) \n\ndt1$value <- 1\n\nmm <- dt1[, c(\"Name\", \"Suite ID\", \"value\"), with = FALSE] |> \n    unique() |> \n    dcast(Name ~ `Suite ID`, value.var = \"value\", fill = 0) |> \n    as.matrix(rownames = \"Name\")\n\nhc_y <- mm |> dist(method = \"binary\") |> hclust(method = \"ward.D2\")\nhc_x <- mm |> t() |> dist(method = \"binary\") |> hclust(method = \"ward.D2\")\n\n\ndt1$Name <- dt1$Name |> factor(levels = hc_y$labels[hc_y$order] |> rev())\ndt1$`Suite ID` <- dt1$`Suite ID` |> factor(levels = hc_x$labels[hc_x$order])\n\n# dt1$Source <- dt1$Source |> factor(levels = c(\"WorkflowHub\", \"Public servers\"))\n\ngr2 <- dt1 |>\n    ggplot(aes(`Suite ID`, Name)) +\n    geom_tile(color = \"white\") +\n    \n    scale_x_discrete(expand = c(0, 0)) +\n    scale_y_discrete(expand = c(0, 0)) +\n    \n    # facet_grid(rows = vars(edam_clean), scales = \"free\", space = \"free\") +\n    \n    # facet_nested_wrap(vars(`EDAM topic`, `EDAM operation`)) +\n    \n    facet_grid2(\n        rows = vars(cluster),\n        cols = vars(`EDAM operations`),\n        space = \"free\",\n        scales = \"free\"\n    ) +\n    \n    coord_cartesian(clip = \"off\", expand = TRUE) +\n    \n    theme_minimal(base_family = \"Calibri\") +\n    theme(\n        axis.text.x = element_text(size = 2.5, angle = 45, hjust = 1),\n        axis.text.y = element_text(size = 6),\n        \n        axis.title.x = element_text(margin = margin(t = 10)),\n        axis.title.y = element_text(margin = margin(r = 10)),\n        \n        panel.border = element_rect(fill = NA, color = \"grey\", linewidth = .3),\n        # axis.ticks = element_line(linewidth = .3, color = \"grey\"),\n        \n        strip.text.x = element_text(face = \"bold\"),\n        strip.text.y = element_text(face = \"bold\", angle = 0, hjust = 0),\n        \n        panel.grid.minor = element_blank(),\n        panel.grid.major = element_line(linetype = \"dashed\", lineend = \"round\", linewidth = .15),\n        \n        plot.margin = margin(10, 10, 10, 10)\n    ) +\n    \n    labs(y = \"Workflows\", x = \"Galaxy Tool Suites\")\n\n\ndt2 <- dt1[, by = Name, .(\"No. of suites\" = `Suite ID` |> unique() |> length())]\n\ndt2$`Perc. of suites` <- dt2$`No. of suites` / (dt1$`Suite ID` |> unique() |> length())\n\ndt2 <- dt2[order(-`No. of suites`)]\n\ngr2\n```\n\n::: {.cell-output-display}\n![](workflows_files/figure-html/unnamed-chunk-4-1.svg)\n:::\n:::",
    "supporting": [
      "workflows_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}